dependencies:
  cache_directories:
    - ~/android

machine:
  environment:
    KEYSTORE: ${HOME}/${CIRCLE_PROJECT_REPONAME}/signing.keystore
    GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xms256m -Xmx2048m -XX:+HeapDumpOnOutOfMemoryError"'
    ANDROID_HOME: '/home/ubuntu/android'
    QEMU_AUDIO_DRV: none
  java:
    version: oraclejdk8
  python:
    version: 2.7.10

test:
  override:
    - python ./script/build.py
    - if [ $CIRCLE_BRANCH = 'master' ]; then ./gradlew assembleRelease; fi
    - if [ $CIRCLE_BRANCH = 'master' ]; then cp -r ${HOME}/${CIRCLE_PROJECT_REPONAME}/Browser/build/outputs/apk $CIRCLE_ARTIFACTS; fi
    - if [ $CIRCLE_BRANCH = 'master' ]; then cp -r ${HOME}/${CIRCLE_PROJECT_REPONAME}/FileExplorer/build/outputs/apk $CIRCLE_ARTIFACTS; fi
  post:
    # - bash <(curl -s https://codecov.io/bash) -t [YOUR_KEY]

deployment:
    production:
        branch: master
        commands:
            # - ./gradlew githubRelease --info
